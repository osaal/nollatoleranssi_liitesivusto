# Puhdistaminen {#sec-puhdistaminen}

---
eval: false
---

Tässä osiossa puhdistamme datatiedostosta joitain virheellisiä kyselyvastauksia sekä tarkistamme puuttuvien vastausten piirteet.

## Esivalmistelu {#sec-puhdistaminen-esivalmistelu}

```{r}
#| label: puhdistaminen-00-paketit

library(tidyverse)
library(mice)

```

```{r}
#| label: puhdistaminen-01-importointi

data <- read.csv2("output/koodattudata.csv")

```

## Suostumuksensa kieltäneiden poistaminen {#sec-puhdistaminen-suostumuskiellot}

Ennen poistamista datatiedostossa oli `r nrow(data)` vastaajaa. Webropolissa tapahtuneen virheen takia kuitenkin osa vastaajista onnistuivat palauttamaan kyselylomakkeen, vaikka he eivät antaneet suostumusta tietojen käsittelyyn. Näillä vastaajilla ei ole muuta tietoa, kuin `k1 == 2`, ja heidät pitää poistaa datatiedostosta.

```{r}
#| label: puhdistaminen-02-suostumuskiellot

# Otetaan mukaan vain suostumuksensa antaneet vastaajat
data <- data |>
  dplyr::filter(k1 == 1)

```

Poistamisen jälkeen datatiedostossa oli `r nrow(data)` vastaajaa.

## Puuttuvien vastausten piirreanalyysi {#sec-puhdistaminen-puuttuvat}

Tähän laitetaan puuttuvien vastausten analysointi `mice`-paketilla. Tarkistetaan ainakin:

1.  Onko datassa vastaajia, jotka jättivät vastaamatta koko kyselyyn? (Eli `NA` kaikissa kysymyksissä, joissa sellainen voi esiintyä)
    1.  Poistetaan datatiedostosta
    2.  Motivaatio: Vaikka he vastasivat taustakysymyksiin (sillä he eivät voineet palauttaa kyselyä vastaamatta pakollisiin kysymyksiin), heidän datansa ei tule sisältymään käytännössä mihinkään analyysiin.

## Datan tallennus {#sec-puhdistaminen-tallennus}

Viimeiseksi data tallennettiin tilapäiseksi tiedostoksi anonymisointia varten. Tallennusta ei ole saatavilla verkkosivun lähdekoodista tietosuojan takia.

```{r}
#| label: puhdistaminen-XX-tallennus

write.csv2(data, file = "output/puhdistettudata.csv")

```
