{
  "hash": "e7edcd3d75975b4f3164826ae553fbdf",
  "result": {
    "markdown": "# Valmistelu {#sec-valmistelu}\n\n\n---\neval: true\n---\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n[[1]]\n[1] TRUE\n```\n:::\n:::\n\n\n## Datatiedoston importointi {#sec-valmistelu-importointi}\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata <- read.csv2(\"output/nimettydata.csv\", tryLogical = FALSE) %>% as_tibble()\n```\n:::\n\n\n## ID-muuttujan koodaus {#sec-valmistelu-id}\n\nTarvitsemme tunnistemuuttujan, jotta voimme myöhemmin uudelleenkoodata organisaatioasemamuuttujan.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata <- data %>%\n  tibble::rowid_to_column(\"ID\")\n```\n:::\n\n\n## Järjestelmä-puuttuvien arvojen uudelleenkoodaus {#sec-valmistelu-puuttuvatarvot}\n\nTässä vaiheessa datatiedosto on täysin raaka. Ensimmäisenä pitää uudelleenkoodata muuttujat seuraavilla tavoilla:\n\n1.  Jos vastaajalle ei tarjottu vastausmahdollisuutta tiettyyn kysymykseen (ketjutusten takia), hänelle merkitään arvo `-1` (SYSMIS, eli järjestelmä-puuttuva).\n2.  Jos vastaajalle tarjottiin vastausmahdollisuus, mutta hän ei vastannut, jätetään arvo `NA` (USRMIS, eli käyttäjä-puuttuva).\n\n### Esiintyvyysmittarit (k3-k4 + k5-k11, k12-k13 + k14-k20) {#sec-valmistelu-puuttuvatarvot-esiintyvyys}\n\n1.  **Tarkennusmittareille erikseen:** Kaikki arvot `1, 2` muutetaan arvoksi `1`, jotta voidaan tehdä summamuuttujia myöhemmin. Muutos tehdään ensin, jotta voidaan sitten tehdä `NA ~ -1` -muutos alla.\n2.  **Kaikki esiintyvyysmittarit** (7 + 7 settiä): Jos vastaaja ei ole kokenut kohtelun muotoa omakohtaisesti *eikä* havainnut sitä, hänen vastauksensa kohtelua vastaavilla lisätietomittareilla tulisi olla `-1`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Mutate-across -verbiyhdistelmällä voidaan muuttaa X määrä muuttujia\n# samaan aikaan, kopioiden kaikki muut muuttujat tulokseen\n\n# Tarkennusmittareilla muutetaan ensin kaikki merkityt arvot (1 tai 2) arvoksi 1\n# Sen jälkeen muutetaan yllä mainitulla logiikalla NA-arvot joko NA:ksi tai arvoksi -1\n# Tämä helpottaa Webropolin arvojen korjauksen: Webropol merkitsee valintaruudun arvoksi numeron, joka vastaa ruudun kysymyksen järjestyslukua. Tämä pitää korjata, jotta voidaan luotettavasti tehdä summamuuttujia ym. myöhemmin.\n\n### Organisaation sisäiset kokemukset\n# Tarkennusmittarit\ndata <- data %>%\n  mutate(\n    across(\n      k5_1_1:k11_16_2,\n      ~ case_match(\n        .x,\n        1 ~ 1,\n        2 ~ 1,\n        NA ~ NA\n      )\n    )\n  )\n\n# Verbaalinen väkivalta\ndata <- data %>%\n  mutate(\n    across(\n      k5_1_1:k5_9_2,\n      ~ case_when(k3_1 == 1 & k4_1 == 1 ~ -1, .default = .x)\n    )\n  )\n\n# Omaisuuden vahingoittaminen ja varastaminen\ndata <- data %>%\n  mutate(\n    across(\n      k6_1_1:k6_10_2,\n      ~ case_when(k3_2 == 1 & k4_2 == 1 ~ -1, .default = .x)\n    )\n  )\n\n# Uhkailu\ndata <- data %>%\n  mutate(\n    across(\n      k7_1_1:k7_14_2,\n      ~ case_when(k3_3 == 1 & k4_3 == 1 ~ -1, .default = .x)\n    )\n  )\n\n# Fyysinen väkivalta\ndata <- data %>%\n  mutate(\n    across(\n      k8_1_1:k8_11_2,\n      ~ case_when(k3_4 == 1 & k4_4 == 1 ~ -1, .default = .x)\n    )\n  )\n\n# Seksuaalinen häirintä tai väkivalta\ndata <- data %>%\n  mutate(\n    across(\n      k9_1_1:k9_10_2,\n      ~ case_when(k3_5 == 1 & k4_5 == 1 ~ -1, .default = .x)\n    )\n  )\n\n# Vihamielisyys tai epäasiallinen kohtelu\ndata <- data %>%\n  mutate(\n    across(\n      k10_1_1:k10_11_2,\n      ~ case_when(k3_6 == 1 & k4_6 == 1 ~ -1, .default = .x)\n    )\n  )\n\n# Syrjintä\ndata <- data %>%\n  mutate(\n    across(\n      k11_1_1:k11_16_2,\n      ~ case_when(k3_7 == 1 & k4_7 == 1 ~ -1, .default = .x)\n    )\n  )\n\n### Organisaation ulkopuoliset kokemukset\n# Tarkennusmittarit\ndata <- data %>%\n  mutate(\n    across(\n      k14_1_1:k20_7_2,\n      ~ case_match(\n        .x,\n        1 ~ 1,\n        2 ~ 1,\n        NA ~ NA\n      )\n    )\n  )\n\n# Verbaalinen väkivalta\ndata <- data %>%\n  mutate(\n    across(\n      k14_1_1:k14_9_2,\n      ~ case_when(k12_1 == 1 & k13_1 == 1 ~ -1, .default = .x)\n    )\n  )\n\n# Omaisuuden vahingoittaminen ja varastaminen\ndata <- data %>%\n  mutate(\n    across(\n      k15_1_1:k15_10_2,\n      ~ case_when(k12_2 == 1 & k13_2 == 1 ~ -1, .default = .x)\n    )\n  )\n\n# Uhkailu\ndata <- data %>%\n  mutate(\n    across(\n      k16_1_1:k16_14_2,\n      ~ case_when(k12_3 == 1 & k13_3 == 1 ~ -1, .default = .x)\n    )\n  )\n\n# Fyysinen väkivalta\ndata <- data %>%\n  mutate(\n    across(\n      k17_1_1:k17_11_2,\n      ~ case_when(k12_4 == 1 & k13_4 == 1 ~ -1, .default = .x)\n    )\n  )\n\n# Seksuaalinen häirintä tai väkivalta\ndata <- data %>%\n  mutate(\n    across(\n      k18_1_1:k18_10_2,\n      ~ case_when(k12_5 == 1 & k13_5 == 1 ~ -1, .default = .x)\n    )\n  )\n\n# Vihamielisyys tai epäasiallinen kohtelu\ndata <- data %>%\n  mutate(\n    across(\n      k19_1_1:k19_11_2,\n      ~ case_when(k12_6 == 1 & k13_6 == 1 ~ -1, .default = .x)\n    )\n  )\n\n# Syrjintä\ndata <- data %>%\n  mutate(\n    across(\n      k20_1_1:k20_7_2,\n      ~ case_when(k12_7 == 1 & k13_7 == 1 ~ -1, .default = .x)\n    )\n  )\n```\n:::\n\n\n### Vaikutusmittarit (k21-k23) {#sec-valmistelu-puuttuvatarvot-vaikutus}\n\n2.  **Reaktiomittarit erikseen**: Kaikki olemassa olevat arvot (ei `NA`) muutetaan arvoksi `1`, jotta voidaan tehdä summamuuttujia myöhemmin. Muutos tehdään ensin, jotta voidaan sitten tehdä `NA ~ -1` -muutos alla.\n3.  **Kaikki vaikutusmittarit**: Jos vastaaja on ilmoittanut, ettei hän ole omakohtaisesti kokenut yhtään epäasiallista kohtelua organisaation sisällä tai ulkopuolella (eli jokaisella kokemuksen ylämittarilla \\[7+7 mittaria\\] vastausarvo on `1` \\[En ollenkaan\\]), hänelle ei näytetä näitä kysymyksiä ja asetetaan siksi arvo `-1`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Koodin selitykselle, ks. koodiblokki 02_sysmis_esiintyvyydet\n\n# Reaktiot, muutetaan kaikki olemassa olevat arvot arvoksi \"1\", jätetään NA\n\ndata <- data %>%\n  mutate(\n    across(\n      k23_1:k23_11,\n      ~ case_when(\n        !is.na(.x) ~ 1,\n        .default = .x\n      )\n    )\n  )\n\n# Vakavuus, pitkäkestoisuus, jatkuu tällä hetkellä, sekä reaktiot\ndata <- data %>%\n  mutate(\n    across(\n      k21_1:k23_11,\n      ~ case_when(\n        k3_1 == 1 & k3_2 == 1 & k3_3 == 1 & k3_4 == 1 & k3_5 == 1 & k3_6 == 1 & k3_7 == 1 & k12_1 == 1 & k12_2 == 1 & k12_3 == 1 & k12_4 == 1 & k12_5 == 1 & k12_6 == 1 & k12_7 == 1 ~ -1,\n        .default = .x)\n    )\n  )\n```\n:::\n\n\n### Ilmoitusjärjestelmien koulutus (k25) {#sec-valmistelu-puuttuvatarvot-ilmokoulutus}\n\n3.  **Ilmoitusjärjestelmien koulutus**: Niistä järjestelmistä, joista vastaaja sanoi että organisaatiossa on olemassa, mutta hän jätti vastaamatta niiden koulutuksen olemassaolosta, koodataan `NA` (käyttäjä-puuttuva). Muille koodataan `-1` (järjestelmä-puuttuva), sillä muut eivät nähneet sen järjestelmän riviä.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Jokainen koulutusrivi erikseen\ndata <- data %>%\n  mutate(\n    across(\n      k25_1,\n      ~ case_when(k24_1 == 2 | k24_1 == 3 ~ -1, .default = .x)\n    )\n  )\n\ndata <- data %>%\n  mutate(\n    across(\n      k25_2,\n      ~ case_when(k24_2 == 2 | k24_2 == 3 ~ -1, .default = .x)\n    )\n  )\n\ndata <- data %>%\n  mutate(\n    across(\n      k25_3,\n      ~ case_when(k24_3 == 2 | k24_3 == 3 ~ -1, .default = .x)\n    )\n  )\n```\n:::\n\n\n### Taustakysymykset {#sec-valmistelu-puuttuvatarvot-taustakysymykset}\n\n4.  **Sopimuspalokuntien organisaatiotoimimuuttujat**: Kaikki olemassa olevat arvot (ei `NA`) muutetaan arvoksi `1`, jotta voidaan myöhemmin hyödyntää muuttujaa organisaatioasemamuuttujan rakentamisessa helpommin. Tämä tehdään ennen kaikkia muita muunnoksia.\n5.  **Taustakysymykset:** Kysymykset verrataan vastaajan organisaatiokuuluvuuteen. Niihin kysymyksiin, joihin vastaaja ei voinut vastata, merkitään arvo `-1`. Koska kaikki taustakysymykset olivat pakollisia, `NA`-arvoja ei pitäisi esiintyä ollenkaan kysymyksillä `k31-k41`.\n    -   Pelastuslaitokset ja ensihoito näkevät kysymykset `k32, k39, k40` (eli ei näe kysymyksiä `k33, k34, k35, k36, k37, k38`)\n    -   Sopimuspalokunnat ja palokuntayhdistykset näkevät kysymykset `k33, k34, k35, k36` (eli ei näe kysymyksiä `k32, k37, k38, k39, k40`)\n    -   Valtakunnalliset järjestöt näkevät kysymykset `k37, k38` (eli ei näe kysymyksiä `k32, k33, k34, k35, k36, k39, k40`)\n    -   Koulutusorganisaatiot näkevät kysymykset `k37, k38` (eli ei näe kysymyksiä `k32, k33, k34, k35, k36, k39, k40`)\n    -   Kaikki näkevät kysymykset `k31, k41, k42, k43`\n    -   Jos vastaaja on suorittavaa henkilöstöä (`k39 == 4`), hän näkee kysymyksen `k40`\n    -   Jos vastaaja tekee varallaoloa (`k34 == 1`), hän näkee kysymyksen `k35`\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Sopimuspalokuntien organisaatiotoimimuuttujien korjaus ennen kaikkia muita koodauksia\ndata <- data %>%\n  mutate(\n    across(\n      k36_1:k36_7,\n      ~ case_when(\n        !is.na(.x) ~ 1,\n        .default = .x\n      )\n    )\n  )\n\n# Pelastuslaitokset ja ensihoito\ndata <- data %>%\n  mutate(\n    across(\n      c(k33, k34, k35, k36_1:k36_7, k37, k38),\n      ~ case_when(k2 == 1 ~ -1, .default = .x)\n    )\n  )\n\n# Sopimuspalokunnat ja palokuntayhdistykset\ndata <- data %>%\n  mutate(\n    across(\n      c(k32, k37, k38, k39, k40),\n      ~ case_when(k2 == 2 ~ -1, .default = .x)\n    )\n  )\n# Valtakunnalliset järjestöt\ndata <- data %>%\n  mutate(\n    across(\n      c(k32:k36_7, k39, k40),\n      ~ case_when(k2 == 3 ~ -1, .default = .x)\n    )\n  )\n\n# Koulutusorganisaatiot\ndata <- data %>%\n  mutate(\n    across(\n      c(k32:k36_7, k39, k40),\n      ~ case_when(k2 == 4 ~ -1, .default = .x)\n    )\n  )\n\n# Vastaaja ei ole suorittavaa henkilöstöä\ndata <- data %>%\n  mutate(\n    across(\n      k40,\n      ~ case_when(k39 == -1 | k39 == 1 | k39 == 2 | k39 == 3 | k39 == 5 | k39 == 6 ~ -1, .default = .x)\n    )\n  )\n\n# Vastaaja ei tee varallaoloa\ndata <- data %>%\n  mutate(\n    across(\n      k35,\n      ~ case_when(k34 == -1 | k34 == 2 ~ -1, .default = .x)\n    )\n  )\n```\n:::\n\n\n## Uudelleenkoodaukset {#sec-valmistelu-uudelleenkoodaukset}\n\nLoogisen tulkittavuuden vuoksi teemme seuraavat uudelleenkoodaukset:\n\n1.  k25\\_\\[1-3\\] (Raportointijärjestelmien koulutuksen olemassaolo):\n    1.  \\(1\\) -\\> (3)\n    2.  \\(2\\) = (2)\n    3.  \\(3\\) -\\> (1)\n    4.  \\(4\\) -\\> (0)\n2.  k26\\_\\[1-18\\] (Asenteet ilmoitusjärjestelmiä kohtaan):\n    1.  \\(1\\) -\\> (7)\n    2.  \\(2\\) -\\> (6)\n    3.  \\(3\\) -\\> (5)\n    4.  \\(4\\) = (4)\n    5.  \\(5\\) -\\> (3)\n    6.  \\(6\\) -\\> (2)\n    7.  \\(7\\) -\\> (1)\n3.  k30\\_\\[1-13\\] (Toimenpiteiden koettu hyödyllisyys):\n    1.  \\(1\\) -\\> (7)\n    2.  \\(2\\) -\\> (6)\n    3.  \\(3\\) -\\> (5)\n    4.  \\(4\\) = (4)\n    5.  \\(5\\) -\\> (3)\n    6.  \\(6\\) -\\> (2)\n    7.  \\(7\\) -\\> (1)\n4.  k34 (Tekee varallaoloa):\n    1.  \\(1\\) = (1)\n    2.  \\(2\\) -\\> (0)\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Raportointijärjestelmien koulutuksen olemassaolo\ndata <- data %>%\n  mutate(\n    across(\n      k25_1:k25_3,\n      ~ case_match(\n        .x,\n        1 ~ 3,\n        2 ~ 2,\n        3 ~ 1,\n        4 ~ 0,\n        -1 ~ -1,\n        NA ~ NA\n      )\n    )\n  )\n\n# Asenteet ilmoitusjärjestelmiä kohtaan\ndata <- data %>%\n  mutate(\n    across(\n      k26_1:k26_18,\n      ~ case_match(\n        .x,\n        1 ~ 7,\n        2 ~ 6,\n        3 ~ 5,\n        4 ~ 4,\n        5 ~ 3,\n        6 ~ 2,\n        7 ~ 1,\n        -1 ~ -1,\n        NA ~ NA\n      )\n    )\n  )\n\n# Tekee varallaoloa\ndata <- data %>%\n  mutate(\n    across(\n      k34,\n      ~ case_match(\n        .x,\n        1 ~ 1,\n        2 ~ 0,\n        -1 ~ -1,\n        NA ~ NA\n      )\n    )\n  )\n```\n:::\n\n\n### Organisaatioaseman ryhmäkoodaus {#sec-valmistelu-uudelleenkoodaukset-organisaatioasema}\n\nEnnen anonymisointia kolmen organisaatioaseman muuttujat (`k36_[1-7], k38, k39`) tulee yhdistää yhdeksi muuttujaksi anonymisointisuunnitelman mukaisesti.\n\nLopullisessa muuttujassa on kuusi luokkaa: (1) Johto- tai esihenkilötaso, (2) Suorittava henkilöstö, (3) Asiantuntijat, (4) Hallinnollinen tai tukipalveluhenkilöstö, (5) Opetushenkilöstö, (6) Opiskelijat.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Jokaisen organisaatioryhmän kohdalla tehdään seuraavasti:\n# 1. Valitse ryhmädata filter()-verbillä\n# 2. Muuta Organisaatioasema-muuttuja ryhmän asemamuuttujan arvojen mukaisesti (ks. taustakysymykset-osio yllä sekä anonymisointisuunnitelma)\n# 3. Päivitä vanha data uuden ryhmädatan riveillä ID-muuttujan avulla rows_update()-verbillä\n\n# Näissä ei tarvitse käsitellä arvoa \"-1\", sillä meillä on täydellinen data käytettävissä jokaiselle organisaatio-ositetulle muuttujalle.\n\n# Laadi tyhjä muuttuja ensin, jotta voidaan yhdistää data myöhemmin\n# Placeholder-arvo on 0\ndata <- data %>%\n  add_column(Organisaatioasema = numeric(nrow(data)))\n\n# Pelastuslaitokset ja ensihoito (k2 == 1)\ndata <- data %>%\n  dplyr::filter(k2 == 1) %>%\n  mutate(\n    Organisaatioasema = case_when(\n      k39 == 1 | k39 == 2 ~ 1,\n      k39 == 3 | k39 == 4 ~ 2,\n      k39 == 5 ~ 3,\n      k39 == 6 ~ 4\n    )\n  ) %>%\n  rows_update(\n    x = data,\n    y = .,\n    by = \"ID\"\n  )\n\n# Valtakunnalliset järjestöt (k2 == 3) sekä koulutusorganisaatiot (k2 == 4)\ndata <- data %>%\n  filter(k2 == 3 | k2 == 4) %>%\n  mutate(\n    Organisaatioasema = case_when(\n      k38 == 1 ~ 1,\n      k38 == 2 ~ 3,\n      k38 == 3 ~ 4,\n      k38 == 4 ~ 5,\n      k38 == 5 ~ 6\n    )\n  ) %>%\n  rows_update(\n    x = data,\n    y = .,\n    by = \"ID\"\n  )\n\n# Seuraavalla pitää yhdistää monivalintakysymykset prioriteettijärjestyksen mukaan.\n# case_when valitsee ensimmäisen vastaavan arvon järjestyksessä, eli voimme käyttää tätä hyödyksemme prioriteetin soveltamisessa.\n\n# Sopimuspalokunnat ja palokuntayhdistykset (k2 == 2)\ndata <- data %>%\n  filter(k2 == 2) %>%\n  mutate(\n    Organisaatioasema = case_when(\n      k36_3 == 1 | k36_6 == 1 ~ 1, # Yhdistystoiminnan johto- tai hallintotehtävät, tai muut vastuutehtävät\n      k36_1 == 1 | k36_2 == 1 | k36_4 == 1 | k36_5 == 1 ~ 2, # Sammutus-, pelastus- tai ensivastetoiminta, operatiiviset johtotehtävät, tai muut vastuutehtävät\n      k36_7 == 1 ~ 4 # Tukitoiminnot\n    )\n  ) %>%\n  rows_update(\n    x = data,\n    y = .,\n    by = \"ID\"\n  )\n\n# Viimeiseksi poistetaan vanhat yksityiskohtaiset muuttujat, koska niitä ei käytetä tulevaisuudessa ollenkaan. Siirretään myös Organisaatioasema loogisempaan paikkaan.\ndata <- data %>%\n  select(-(k36_1:k36_7) & -(k38:k39)) %>%\n  relocate(Organisaatioasema, .before = k40)\n```\n:::\n\n\n## Datan tallennus {#sec-valmistelu-datatallennus}\n\nKoodausten jälkeen tallensimme lopullisen datatiedoston `csv`-muotoon. Tallennusta ei ole saatavilla verkkosivun lähdekoodista tietosuojan takia.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite.csv2(data, file = \"output/koodattudata.csv\", row.names = FALSE)\n```\n:::\n",
    "supporting": [
      "valmistelu_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}