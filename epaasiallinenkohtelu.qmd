# Epäasiallisen kohtelun mittaristo

## Yleismallin määrittely

```{r}
#| eval: false

# Epäasiallisen kohtelun kuuden ulottuvuuden CFA-malli
yleismalli <- '
  # Malli 1

  # Latentit muuttujat
    omakohtainen_a =~ verb1 + oma1 + uhk1 + fyy1 + seks1 + viha1
    havaittu_a =~ verb2 + oma2 + uhk2 + fyy2 + seks2 + viha2
    omakohtainen_b =~ verb3 + oma3 + uhk3 + fyy3 + seks3 + viha3
    havaittu_b =~ verb4 + oma4 + uhk4 + fyy4 + seks4 + viha4

  # Estimoitavat kovarianssit
    omakohtainen_a ~~ havaittu_a
    omakohtainen_b ~~ havaittu_b
    
  # Kovarianssit, jotka lukitaan nollaan
    omakohtainen_a ~~ 0*omakohtainen_b
    havaittu_a ~~ 0*havaittu_b
'
```

Muuttuja `yleismalli` on Malli 1: Epäasiallisen kohtelun kuusi ulottuvuutta neljässä tekijä. ja tekokontekstiryhmässä. Jokainen ulottuvuus on mitattu erikseen kyselytutkimuksessa. Mallissa on seuraavat latentit muuttujat:

-   `omakohtainen_a`: Itse kohdattu epäasiallinen kohtelu organisaation sisällä.

-   `omakohtainen_b`: Itse kohdattu epäasiallinen kohtelu organisaation ulkopuolella.

-   `havaittu_a`: Kollegan havaittu epäasiallinen kohtelu organisaation sisällä.

-   `havaittu_b`: Kollegan havaittu epäasiallinen kohtelu organisaation ulkopuolella.

Mallissa estimoidaan kahden faktoriparin kovarianssit: `omakohtainen_a ~~ havaittu_a` ja `omakohtainen_b ~~ havaittu_b`. Omakohtaisten kokemusten kahden faktorin kovarianssi lukitaan nollaan, samoin havaittujen kokemusten kahden faktorin kovarianssi: `omakohtainen_a ~~ 0*omakohtainen_b` ja `havaittu_a ~~ 0*havaittu_b`.

Yleismallin vapausasteet laskettiin käyttäen Cortinan ja kollegoiden *Shiny*-applikaatiota osoitteessa <https://gmuiopsych.shinyapps.io/degreesoffreedom/> [haettu 7.3.2024; @cortina2017]. Mallin vapausasteet ovat $\text{df}_M = 248$. Applikaation asetuksina käytettiin seuraavia arvoja:

-   Model type: CFA/SEM

-   Number of Indicators: 24 (kaikki 24 havaittua muuttujaa)

-   Number of Single Item Indicators: 0

-   Number of Latent Exogenous Variables: 4 (kaikki 4 latenttia muuttujaa)

-   Number of Latent Endogenous Variables: 0

-   Number of Constrained Exogenous Relationships: 2 (molemmat nollaan sidotut latenttien muuttujien kovarianssit)

-   Number of Paths between Exogenous and Endogenous Variables: 0

-   Number of Causal Paths between Endogenous Variables: 0

-   Number of Measurement Error Covariances: 0

-   Number of Relations among Structural Disturbances: 0

Tällöin informaation (kovarianssien ja varianssien) määräksi saatiin 300 ja estimoitavien parametrien määräksi 52, jolloin $\text{df}_M = 300-52 = 248$.

## Tilastollisen voiman testi

```{r}
#| eval: false
library(WebPower)

otoskoot <- list()

for (i in c(0.1, 0.3, 0.5)) {
  tulos <- WebPower::wp.sem.chisq(
    n = NULL,
    df = 248,
    effect = i,
    power = 0.8,
    alpha = 0.05
  )
  otoskoot <- c(otoskoot, tulos$n)
}

# Pyöristetään otoskoot ylöspäin
otoskoot <- lapply(otoskoot, function(x) {ceiling(x)})
```

Khiin neliön testin luotettavalle käytölle 80 prosentin tilastollisella voimalla tarvitsemme seuraavat otoskoot riippuen efektikoosta:

-   Efektikoko `0.1`: $n = 610$

-   Efektikoko `0.3`: $n = 204$

-   Efektikoko `0.5`: $n = 123$

## CFA-mallin asettaminen ja testaaminen

```{r}
#| eval: false

library(lavaan)
library(semTools)

# Muista lisätä itse data!
mallidata <- data.frame()

sovitettu_yleinen <- lavaan::cfa(
  yleismalli,
  data = mallidata,
  fit.measures = TRUE,
  standardized = TRUE,
  estimator = "MLR",
  missing = "ML", # FIML-menetelmä puuttuville arvoille
  test = "robust",
  se = "robust"
)

# Mallin invarianssitestaus suoritetaan lavaan-paketilla automaattisesti. Käytetään Satorra-Bentley-korjattu khiin neliötä.

# Kohderyhmä
invarianssi_kohderyhmä <- semTools::measurementInvariance(
  model = sovitettu_yleinen,
  data = mallidata,
  group = "kohderyhmä",
  strict = TRUE
)
# Kieliversio
invarianssi_kieli <- semTools::measurementInvariance(
  model = sovitettu_yleinen,
  data = mallidata,
  group = "kieli",
  strict = TRUE
)
# Yhteydenottomenetelmät
invarianssi_yhteydenotto <- semTools::measurementInvariance(
  model = sovitettu_yleinen,
  data = mallidata,
  group = "yhteydenotto",
  strict = TRUE
)
```

Sovitettava malli estimoidaan robustilla *Maximum Likelihood* -estimaattorilla (`estimator = "MLR"`). Puuttuvat arvot käsitellään "full information maximum likelihood"-menetelmällä (`missing = "ML"`).
